---
title: "KCHS Math Presentation"
author: "Nehemias Ulloa"
format: 
  revealjs:
    embed-resources: true
    self-contained-math: true
---

```{r setup, include=FALSE}
#| label: setup
library(tidyverse)
library(MF)

mlesion <- mlesions %>%
  mutate(animalID = sample(1:1000, size=nrow(.), replace=FALSE)) %>%
  mutate(animalID = factor(x=animalID, levels=animalID[order(les)]))
```



## About Me

+ Bakersfield, CA

![ ](Figures/Bakersfield_Map.jpg)


## About Me

+ Bakersfield, CA
+ CSU Bakersfield - B.S. Math with Statistics Emphasis

::: {layout-ncol=2}
![Ariel View of CSUB Campus](Figures/CSUB.jpg)

![CSUB Roadrunner](Figures/Roadrunner.jpg)
:::


## About Me

+ Bakersfield, CA
+ CSU Bakersfield - BS Math with Statistics Emphasis
+ Iowa State University - Ph.D. Statistics

![Iowa State Campus](Figures/ISU.jpg)


## What Do I Do

::: {.incremental}
* CVB (Center for Veterinary Biologics)
  + USDA - MRP - APHIS - VS
  + {{< video https://www.youtube.com/watch?v=5lBG4fuJL4A >}}
  + License Biologics
    - Regulate Vaccines
    - Regulate Assays
    - Regulate Diagnostics
:::


## Regulating Vaccines

::: {.incremental}
* Company wants to license vaccine
  + e.g. Bordetella bronchiseptica Vaccine in Dogs
  + Submit a Licensing Plan
  + Submit Multiple Studies
    - Safety Study
    - Shed/Spread Study
    - Assay Validation
    
    ::: {.fragment .highlight-red}
    - Efficacy Study
    :::
:::



## Example - Lung Lesions in Dogs

::: {.incremental}
* Study Design

  ::::{layout-ncol=2}
  
  + 2 Treatments Groups
  + Randomization
  + Blinding
  
  :::{#col2}
  
  + Vaccinated/Challenged on Same Day
  + Similar Housing/Living Conditions
  + Same Breed
  + Both Male and Female Dogs
  
  :::
  
  ::::
  
:::

## Boxplot

```{r}
#| echo: true
mlesion %>%
  ggplot(aes(y=les, x=tx, color=tx)) +
    geom_boxplot() + 
    geom_point() +
    labs(y="Lung Lesion Score", color="Treatment", x="Treatment") + 
    scale_color_manual(values=c("black", "red")) +
    theme_bw()
```

## Boxplot

```{r}
#| label: lesions_boxplot
mlesion %>%
  ggplot(aes(y=les, x=tx, color=tx)) +
    geom_boxplot() + 
    geom_point() +
    labs(y="Lung Lesion Score", color="Treatment", x="Treatment") + 
    scale_color_manual(values=c("black", "red")) +
    theme_bw()
```


## Dot Plot

```{r}
#| echo: true
mlesion %>%
  ggplot(aes(x=les, y=animalID, color=tx)) +
    geom_point() + 
    labs(x="Lung Lesion Score", y="AnimalID", color="Treatment") + 
    scale_color_manual(values=c("black", "red")) +
    theme_bw()
```

## Dot Plot

```{r}
#| label: lesions_dotplot
mlesion %>%
  ggplot(aes(x=les, y=animalID, color=tx)) +
    geom_point() + 
    labs(x="Lung Lesion Score", y="AnimalID", color="Treatment") + 
    scale_color_manual(values=c("black", "red")) +
    theme_bw()
```


## Analysis

::: {.r-stack}
::: {.fragment .fade-in-then-out}
Mean

```{r}
#| echo: true
mlesion %>%
  group_by(tx) %>%
  summarise(`Mean Lung Lesion Score` = mean(les))
```
:::

::: {.fragment .fade-in-then-out}
Standard Deviation
  
```{r}
#| echo: true
mlesion %>%
  group_by(tx) %>%
  summarise(`Lung Lesion Score sd` = sd(les))
```
:::

::: {.fragment .fade-in-then-out}
Median
  
```{r}
#| echo: true
mlesion %>%
  group_by(tx) %>%
  summarise(`Median Lung Lesion` = quantile(les, probs=0.5))
```
:::
:::



## Analysis

```{r}
#| echo: true
mlesion %>%
  group_by(tx) %>%
  summarise(`Mean Lung Lesion Score` = mean(les),
            `Lung Lesion Score sd` = sd(les),
            `Median Lung Lesion` = quantile(les, probs=0.5)) %>%
  mutate(across(where(is.numeric), round, 2))
```


## Analysis

```{r}
#| label: lesions_distplot
mlesion %>%
  ggplot(aes(x=les, color=tx)) +
    geom_density() + 
    labs(x="Lung Lesion Score", color="Treatment") + 
    scale_color_manual(values=c("black", "red")) +
    theme_bw() +
    facet_grid(~tx)
```


## Analysis

::: {.incremental}

* Mitigated Fraction
  + MF is the relative increase in the probability that a vaccinate’s disease will be less severe than a nonvaccinate’s disease.
  + MF evaluates the intervention’s effect by the probability a subject will benefit from the intervention
  + Here's the code
  
    ```{r}
    #| echo: true
    MF::MFr(les ~ tx, data=mlesion)
    ```
  
:::




## Analysis

What if we knew more information about the housing?

::: {.fragment .fade-in}
```{r}
#| label: lesions_dotplot_cage
mlesion %>%
  ggplot(aes(x=les, y=animalID, color=tx)) +
    geom_point() + 
    labs(x="Lung Lesion Score", y="AnimalID", color="Treatment") + 
    scale_color_manual(values=c("black", "red")) +
    theme_bw() +
    facet_wrap(~paste0("Cage: ", cage), scale="free_y")
```
:::


## Analysis - Matched Pairs

```{r}
#| echo: true
MF::MFmp(les ~ tx + cluster(cage), data=mlesion)
```

## Finally

Questions?
